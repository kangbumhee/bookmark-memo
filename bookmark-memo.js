(function(){const DONATE_LINK="https://i.imgur.com/1mpOXhP.png";if(document.getElementById('bm-memo')){document.getElementById('bm-memo').style.display='block';return}const s=document.createElement('style');s.textContent='@keyframes flash{0%,100%{background:#fff}50%{background:#dbeafe}}#bm-memo{position:fixed;top:20px;right:50px;width:520px;min-width:360px;min-height:220px;max-width:90vw;max-height:80vh;background:#f5f5f5;border-radius:24px;border-top-left-radius:28px;border-top-right-radius:28px;box-shadow:0 8px 32px rgba(0,0,0,.15);z-index:2147483647;font-family:system-ui;border:2px solid #374151;overflow:hidden}#bm-hdr{background:linear-gradient(135deg,#374151,#1f2937);padding:16px 20px;cursor:move;display:flex;justify-content:space-between;align-items:center;color:#fff;user-select:none}#bm-hdr h2{font-size:16px;font-weight:600;margin:0;pointer-events:none}#bm-hdr button{background:rgba(255,255,255,.2);border:none;color:#fff;width:36px;height:36px;border-radius:10px;cursor:pointer;font-size:22px;line-height:1}#bm-body{padding:20px;max-height:70vh;overflow-y:auto}#bm-body::-webkit-scrollbar{width:6px}#bm-body::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:3px}.bm-tools{display:flex;gap:6px;margin-bottom:10px}.bm-btn{background:#fff;border:1px solid #d1d5db;padding:6px 10px;border-radius:6px;cursor:pointer;font-size:13px;transition:all .2s}.bm-btn:hover{background:#f3f4f6}.bm-ep{display:none;background:#fff;padding:10px;border:1px solid #d1d5db;border-radius:8px;margin-bottom:8px;max-height:150px;overflow-y:auto}.bm-ep.show{display:block}.bm-eg{display:grid;grid-template-columns:repeat(6,1fr);gap:4px}.bm-eg button{background:none;border:none;padding:8px;cursor:pointer;font-size:22px;border-radius:6px;transition:background .2s}.bm-eg button:hover{background:#f3f4f6}#txt{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;min-height:120px;background:#fff;resize:vertical;overflow-y:auto}#txt:focus{outline:none;border-color:#374151}#txt:empty:before{content:attr(data-placeholder);color:#9ca3af}.bm-save{background:linear-gradient(135deg,#374151,#1f2937);color:#fff;border:none;padding:12px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;width:100%;margin:10px 0;transition:all .2s}.bm-save:hover{transform:translateY(-2px)}.bm-actions{display:flex;gap:8px;margin-bottom:16px;position:relative;flex-wrap:wrap}.bm-ib{background:#fff;border:1px solid #d1d5db;width:40px;height:40px;border-radius:8px;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;transition:all .2s}.bm-ib:hover{background:#f3f4f6;transform:translateY(-2px)}.bm-search-wrap{position:relative;width:100%;display:none}.bm-search-wrap.show{display:block}.bm-search{display:flex;gap:8px;width:100%;margin-top:8px}.bm-search input{flex:1;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;background:#fff}.bm-search button{background:#374151;color:#fff;border:none;padding:10px 18px;border-radius:8px;cursor:pointer;white-space:nowrap}.bm-donate{display:none;background:#fff;padding:20px;border-radius:12px;border:2px solid #d1d5db;box-shadow:0 8px 20px rgba(0,0,0,.15);width:100%;text-align:center;margin-top:8px}.bm-donate.show{display:block}.bm-donate h3{margin:0 0 8px;font-size:16px;color:#111827}.bm-donate p{margin:0 0 14px;font-size:13px;color:#4b5563;line-height:1.6}.bm-donate a{display:inline-block;padding:10px 16px;background:#374151;color:#fff;border-radius:8px;text-decoration:none;font-size:13px}.bm-item{background:#fff;padding:14px;margin-bottom:10px;border-radius:10px;border:1px solid #e5e7eb;cursor:pointer;position:relative}.bm-item:hover{box-shadow:0 2px 8px rgba(0,0,0,.08)}.bm-item.flash{animation:flash 1s 2}.bm-item.drag-over{border-top:3px solid #6366f1}.bm-top{display:flex;justify-content:space-between;align-items:center}.bm-left{display:flex;gap:10px;flex:1;align-items:center}.bm-num{font-weight:700;color:#6366f1;font-size:15px}.bm-prev{color:#1f2937;font-size:14px;flex:1}.bm-date{font-size:11px;color:#9ca3af;margin-top:8px;display:none}.bm-item.exp .bm-date{display:block}.bm-full{margin-top:12px;padding-top:12px;border-top:1px solid #e5e7eb;display:none;font-size:14px;line-height:1.6;color:#374151;white-space:pre-wrap}.bm-item.exp .bm-full{display:block}.bm-acts{display:flex;gap:6px}.bm-acts button{border:none;padding:5px 12px;border-radius:6px;cursor:pointer;font-size:12px;color:#fff;transition:all .2s}.bm-ed{background:#3b82f6}.bm-ed:hover{background:#2563eb}.bm-del{background:#ef4444}.bm-del:hover{background:#dc2626}.bm-conf{position:absolute;top:-50px;right:0;background:#fff;border:2px solid #ef4444;border-radius:8px;padding:10px 12px;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:10;display:none}.bm-conf.show{display:block}.bm-conf p{margin:0 0 8px;font-size:12px;color:#374151;font-weight:500}.bm-conf button{padding:5px 12px;border:none;border-radius:4px;cursor:pointer;font-size:11px;margin:0 3px}.bm-em{display:none;margin-top:12px;padding-top:12px;border-top:1px solid #e5e7eb}.bm-em.show{display:block}.bm-em div{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:13px;min-height:80px;resize:vertical;overflow-y:auto;background:#fff}.bm-em div:focus{outline:none;border-color:#374151}.bm-em button{margin-top:8px;margin-right:6px;padding:6px 14px;border:none;border-radius:6px;cursor:pointer;font-size:12px;color:#fff}.bm-pag{display:flex;justify-content:center;gap:8px;margin:16px 0;flex-wrap:wrap}.bm-pag button{background:#fff;border:1px solid #d1d5db;padding:8px 14px;border-radius:6px;cursor:pointer;font-size:13px;transition:all .2s}.bm-pag button:hover{border-color:#374151}.bm-pag button.active{background:#374151;color:#fff;border-color:#374151}.bm-pag button.drag-over{background:#dbeafe;border-color:#6366f1}.bm-empty{text-align:center;color:#9ca3af;padding:24px;background:#fff;border-radius:10px;font-size:14px}#bm-rsz{position:absolute;right:6px;bottom:6px;width:16px;height:16px;border-right:3px solid #9ca3af;border-bottom:3px solid #9ca3af;cursor:nwse-resize;border-radius:3px;opacity:.8}';document.head.appendChild(s);const em=['ğŸ˜€','ğŸ˜‚','ğŸ˜','ğŸ˜','ğŸ¤”','ğŸ‰','â¤ï¸','ğŸ‘','ğŸ”¥','âœ…','ğŸ˜Š','ğŸ¥³','ğŸ’ª','â­','ğŸ’¯','ğŸ˜­','ğŸ™','ğŸ˜…'];const d=document.createElement('div');d.id='bm-memo';d.innerHTML='<div id="bm-hdr"><h2>ğŸ”– ë¶ë§ˆí¬ ë©”ëª¨ì¥</h2><button id="cls" title="ë‹«ê¸°">Ã—</button></div><div id="bm-body"><div class="bm-tools"><button class="bm-btn" id="bold" title="êµµê²Œ (ì„ íƒì˜ì—­)">B</button><button class="bm-btn" id="emb" title="ì´ëª¨ì§€ ì‚½ì…">ğŸ˜€</button></div><div class="bm-ep" id="epan"><div class="bm-eg">'+em.map(e=>'<button title="ì´ëª¨ì§€ '+e+'">'+e+'</button>').join('')+'</div></div><div id="txt" contenteditable="true" data-placeholder="ì´ê³³ì— ë©”ëª¨ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”..."></div><button class="bm-save" id="sav" title="ë©”ëª¨ ì €ì¥ (Ctrl/âŒ˜+Enter)">ğŸ’¾ ì €ì¥</button><div class="bm-actions"><button class="bm-ib" id="tog" title="ëª©ë¡ ì ‘ê¸°/í¼ì¹˜ê¸°">â˜°</button><button class="bm-ib" id="srci" title="ê²€ìƒ‰ ì—´ê¸°/ë‹«ê¸°">ğŸ”</button><button class="bm-ib" id="exc" title="CSVë¡œ ë‚´ë³´ë‚´ê¸°">ğŸ“Š</button><button class="bm-ib" id="doni" title="ê¸°ë¶€í•˜ê¸°">ğŸ˜Š</button><div class="bm-search-wrap" id="srchw"><div class="bm-search"><input id="srci2" placeholder="ë©”ëª¨ ê²€ìƒ‰..."><button id="srcb" title="ê²€ìƒ‰ ì‹¤í–‰">ê²€ìƒ‰</button></div></div><div class="bm-donate" id="don"><h3>â˜• ê³ ë§™ìŠµë‹ˆë‹¤!</h3><p>ì—¬ëŸ¬ë¶„ì˜ ì‘ì€ ì‘ì›ì´ ë” ì¢‹ì€ ê¸°ëŠ¥ê³¼ ì•ˆì •ì ì¸ ì—…ë°ì´íŠ¸ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.<br>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë§í¬ë¡œ ì´ë™í•´ ì£¼ì„¸ìš” ğŸ™</p><a id="openDonate" href="'+DONATE_LINK+'" target="_blank" rel="noopener" title="ìƒˆ íƒ­ì—ì„œ ì—´ê¸°">ë§í¬ë¡œ ì´ë™</a></div></div><div id="list"></div><div class="bm-pag" id="pag"></div><div id="bm-rsz" title="í¬ê¸° ì¡°ì ˆ"></div>';document.body.appendChild(d);let drag=0,ox,oy,col=0,flt="",page=1,pp=5,dri=null,rsz=0,rw=0,rh=0,rx=0,ry=0;const hdr=d.querySelector('#bm-hdr'),txt=d.querySelector('#txt'),epan=d.querySelector('#epan'),srchw=d.querySelector('#srchw'),don=d.querySelector('#don'),rs=d.querySelector('#bm-rsz');function savePos(){const r=d.getBoundingClientRect();localStorage.setItem('bmMemoPos',JSON.stringify({l:d.style.left||'',t:d.style.top||'',w:r.width,h:r.height}))}function loadPos(){try{const p=JSON.parse(localStorage.getItem('bmMemoPos')||'null');if(p){d.style.left=p.l||'';d.style.top=p.t||'';if(p.w)d.style.width=p.w+'px';if(p.h)d.style.height=p.h+'px';d.style.right=p.l?'auto':d.style.right}}catch(e){}}txt.addEventListener('focus',()=>{if(!txt.textContent.trim())txt.innerHTML=''});txt.addEventListener('blur',()=>{if(!txt.textContent.trim())txt.innerHTML=''});hdr.onmousedown=e=>{if(e.target.id==='cls')return;drag=1;ox=e.clientX-d.offsetLeft;oy=e.clientY-d.offsetTop;e.preventDefault()};document.onmousemove=e=>{if(drag){let nt=e.clientY-oy;if(nt<0)nt=0;d.style.left=e.clientX-ox+'px';d.style.top=nt+'px';d.style.right='auto'}if(rsz){let nw=Math.max(360,rw+(e.clientX-rx));let nh=Math.max(220,rh+(e.clientY-ry));d.style.width=nw+'px';d.style.height=nh+'px'}};document.onmouseup=()=>{if(drag||rsz)savePos();drag=0;rsz=0};rs.onmousedown=e=>{rsz=1;const r=d.getBoundingClientRect();rw=r.width;rh=r.height;rx=e.clientX;ry=e.clientY;e.preventDefault()};d.querySelector('#cls').onclick=()=>{savePos();d.remove()};d.querySelector('#srci').onclick=()=>srchw.classList.toggle('show');d.querySelector('#doni').onclick=()=>don.classList.toggle('show');d.querySelector('#emb').onclick=()=>epan.classList.toggle('show');d.querySelectorAll('.bm-eg button').forEach(b=>{b.onclick=function(){const sel=window.getSelection();if(sel.rangeCount>0){const range=sel.getRangeAt(0);range.deleteContents();const node=document.createTextNode(this.textContent);range.insertNode(node);range.setStartAfter(node);range.setEndAfter(node);sel.removeAllRanges();sel.addRange(range)}epan.classList.remove('show');txt.focus()}});d.querySelector('#bold').onclick=()=>{const sel=window.getSelection();if(sel&&!sel.isCollapsed){document.execCommand('bold',false,null);txt.focus()}};d.querySelector('#exc').onclick=()=>{try{const r=localStorage.getItem('bmMemos');const a=r?JSON.parse(r):[];if(!a.length){alert('ì €ì¥ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤');return}let c='ë²ˆí˜¸,ë‚´ìš©,ë‚ ì§œ\n';a.forEach((m,i)=>{const t=m.t.replace(/<[^>]*>/g,'').replace(/"/g,'""').replace(/\n/g,' ');const dt=new Date(m.d).toLocaleString('ko-KR');c+=`${i+1},"${t}","${dt}"\n`});const b=new Blob(['\uFEFF'+c],{type:'text/csv;charset=utf-8;'});const l=document.createElement('a');l.href=URL.createObjectURL(b);l.download='ë©”ëª¨_'+new Date().toISOString().slice(0,10)+'.csv';l.click();alert('âœ… ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!')}catch(err){alert('âŒ ì‹¤íŒ¨')}};function load(f=''){try{const r=localStorage.getItem('bmMemos');const a=r?JSON.parse(r):[];const ms=f?a.filter(m=>m.t.toLowerCase().includes(f.toLowerCase())):a;const list=d.querySelector('#list'),pag=d.querySelector('#pag');if(col){list.style.display='none';pag.style.display='none';return}list.style.display='block';pag.style.display='flex';if(!ms.length){list.innerHTML='<div class="bm-empty">'+(f?'ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ':'ì €ì¥ëœ ë©”ëª¨ ì—†ìŒ')+'</div>';pag.innerHTML='';return}const tp=Math.ceil(ms.length/pp),st=(page-1)*pp,pm=ms.slice(st,st+pp);list.innerHTML=pm.map((m,i)=>{const pv=m.t.replace(/<[^>]*>/g,'').substring(0,50);const dt=new Date(m.d).toLocaleString('ko-KR');const ix=a.indexOf(m);return`<div class="bm-item" draggable="true" data-i="${ix}"><div class="bm-top"><div class="bm-left"><span class="bm-num">${st+i+1}.</span><span class="bm-prev">${pv}${m.t.length>50?'...':''}</span></div><div class="bm-acts"><button class="bm-ed" data-i="${ix}" title="ë©”ëª¨ ìˆ˜ì •">ìˆ˜ì •</button><button class="bm-del" data-i="${ix}" title="ë©”ëª¨ ì‚­ì œ">ì‚­ì œ</button></div></div><div class="bm-conf"><p>ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p><button style="background:#ef4444;color:#fff" class="yes">ì˜ˆ</button><button style="background:#e5e7eb;color:#374151" class="no">ì•„ë‹ˆì˜¤</button></div><div class="bm-em"><div contenteditable="true" class="et">${m.t}</div><button style="background:#3b82f6;color:#fff" class="se" title="ìˆ˜ì • ë‚´ìš© ì €ì¥">ì €ì¥</button><button style="background:#6b7280;color:#fff" class="ce" title="ìˆ˜ì • ì·¨ì†Œ">ì·¨ì†Œ</button></div><div class="bm-full">${m.t}</div><div class="bm-date">ğŸ“… ${dt}</div></div>`}).join('');if(tp>1){pag.innerHTML=Array.from({length:tp},(v,i)=>`<button class="${i+1===page?'active':''}" data-p="${i+1}" title="${i+1}í˜ì´ì§€ë¡œ ì´ë™">${i+1}</button>`).join('');d.querySelectorAll('#pag button').forEach(b=>{b.onclick=()=>{page=parseInt(b.dataset.p);load(flt)};b.ondragover=e=>{e.preventDefault();b.classList.add('drag-over')};b.ondragleave=()=>b.classList.remove('drag-over');b.ondrop=e=>{e.preventDefault();b.classList.remove('drag-over');if(dri!==null){const r=localStorage.getItem('bmMemos');const a=r?JSON.parse(r):[];const m=a.splice(dri,1)[0];a.splice((parseInt(b.dataset.p)-1)*pp,0,m);localStorage.setItem('bmMemos',JSON.stringify(a));page=parseInt(b.dataset.p);load(flt);dri=null}}})}else pag.innerHTML='';d.querySelectorAll('.bm-item').forEach(el=>{el.ondragstart=()=>{dri=parseInt(el.dataset.i);el.style.opacity='0.5'};el.ondragend=()=>{el.style.opacity='1';dri=null};el.ondragover=e=>{e.preventDefault();el.classList.add('drag-over')};el.ondragleave=()=>el.classList.remove('drag-over');el.ondrop=e=>{e.preventDefault();el.classList.remove('drag-over');if(dri!==null){const ti=parseInt(el.dataset.i);const r=localStorage.getItem('bmMemos');const a=r?JSON.parse(r):[];const m=a.splice(dri,1)[0];const ni=a.findIndex(mm=>a.indexOf(mm)===ti);a.splice(ni>=0?ni:0,0,m);localStorage.setItem('bmMemos',JSON.stringify(a));load(flt);dri=null}};el.querySelector('.bm-top').onclick=e=>{if(e.target.closest('.bm-acts')||e.target.closest('.bm-conf')||e.target.closest('.bm-em'))return;el.classList.toggle('exp')}});d.querySelectorAll('.bm-ed').forEach(b=>{b.onclick=e=>{e.stopPropagation();const it=b.closest('.bm-item');it.draggable=false;it.querySelector('.bm-em').classList.add('show');it.querySelector('.bm-full').style.display='none'}});d.querySelectorAll('.se').forEach(b=>{b.onclick=e=>{e.stopPropagation();const it=b.closest('.bm-item'),nt=it.querySelector('.et').innerHTML.trim();if(nt){const r=localStorage.getItem('bmMemos');const a=r?JSON.parse(r):[];a[parseInt(it.dataset.i)]={t:nt,d:new Date().toISOString()};localStorage.setItem('bmMemos',JSON.stringify(a));load(flt)}}});d.querySelectorAll('.ce').forEach(b=>{b.onclick=e=>{e.stopPropagation();const it=b.closest('.bm-item');it.draggable=true;it.querySelector('.bm-em').classList.remove('show');it.querySelector('.bm-full').style.display=''}});d.querySelectorAll('.bm-del').forEach(b=>{b.onclick=e=>{e.stopPropagation();const cf=b.closest('.bm-item').querySelector('.bm-conf');cf.classList.add('show');cf.querySelector('.yes').onclick=ev=>{ev.stopPropagation();const r=localStorage.getItem('bmMemos');const a=r?JSON.parse(r):[];a.splice(parseInt(b.dataset.i),1);localStorage.setItem('bmMemos',JSON.stringify(a));page=1;load(flt)};cf.querySelector('.no').onclick=ev=>{ev.stopPropagation();cf.classList.remove('show')}}})}catch(err){console.error(err)}}load();d.querySelector('#srcb').onclick=()=>{flt=d.querySelector('#srci2').value.trim();page=1;load(flt)};d.querySelector('#srci2').onkeypress=e=>{if(e.key==='Enter'){flt=e.target.value.trim();page=1;load(flt)}};d.querySelector('#tog').onclick=()=>{col=!col;load(flt)};d.querySelector('#doni').onclick=()=>{don.classList.toggle('show')};d.querySelector('#sav').onclick=()=>{const t=txt.innerHTML.trim();if(!t||t==='<br>'||t==='<div><br></div>'){alert('ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”');return}try{const r=localStorage.getItem('bmMemos');const a=r?JSON.parse(r):[];a.unshift({t:t,d:new Date().toISOString()});localStorage.setItem('bmMemos',JSON.stringify(a));txt.innerHTML='';flt='';d.querySelector('#srci2').value='';page=1;load();d.querySelector('#bm-body').scrollTop=0;setTimeout(()=>{const f=d.querySelector('.bm-item');if(f){f.classList.add('flash');setTimeout(()=>f.classList.remove('flash'),2000)}},100)}catch(err){alert('âŒ ì €ì¥ ì‹¤íŒ¨')}};txt.onkeydown=e=>{if((e.ctrlKey||e.metaKey)&&e.key==='Enter'){e.preventDefault();d.querySelector('#sav').click()}};window.addEventListener('resize',()=>{const br=d.getBoundingClientRect();const vw=window.innerWidth,vh=window.innerHeight;let nl=Math.min(Math.max(0,br.left),vw-200),nt=Math.min(Math.max(0,br.top),vh-120);d.style.left=nl+'px';d.style.top=nt+'px';d.style.right='auto';savePos()});loadPos();})();
